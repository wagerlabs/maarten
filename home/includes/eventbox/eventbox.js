if(!perpetuacms){var perpetuacms={}}perpetuacms.eventbox=Class.create({initialize:function(d,e){var c=1;this.isPaused=false;this.navigationIsPaused=false;this.isTransitioning=false;this.videoIsPlaying=false;this.flowplayerID=false;if(Object.isElement(d)){c=0}d=$(d);this.eventbox_container=d;this.eventbox_container.store("eventbox",this);var a={delay:3000,order:"sequential",type:"fade",duration:0.5,showEmptyDescriptions:false,pauseOnMouseOver:true,effectDelay:0,setAsBackground:false,transitionDescriptions:false,startPaused:false,firstSlide:1,slider:{active:false,button_next:"",button_previous:"",container:"",orientation:"horizontal",step:4,view:4},video:{hideOverlay:false,popupSettings:{top:50,padding:10,backgroundColor:"#000",className:""}},flowplayer_settings:{swf:"/includes/videoplayers/flowplayer/flowplayer.swf",key:null,logo:null}};if(!e){e={}}this.settings=Object.extend(Object.extend({},a),e);this.settings.slider=Object.extend(Object.extend({},a.slider),e.slider);this.settings.video=Object.extend(Object.extend({},a.video),e.video);this.settings.flowplayer_settings=Object.extend(Object.extend({},a.flowplayer_settings),e.flowplayer_settings);this.onBeforeLoaded=this.settings.onBeforeLoaded||function(){};this.onLoaded=this.settings.onLoaded||function(){};this.onBeforePause=this.settings.onBeforePause||function(){};this.onPause=this.settings.onPause||function(){};this.onBeforeResume=this.settings.onBeforeResume||function(){};this.onResume=this.settings.onResume||function(){};this.onBeforeTransition=this.settings.onBeforeTransition||function(){};this.onTransition=this.settings.onTransition||function(){};this.onBeforeLoaded();if(this.settings.delay<100){this.settings.delay=this.settings.delay/0.001}if(c==1){this.objWindowContainer=$(this.eventbox_container.identify()+"Window");this.objWindow=this.objWindowContainer.select("div");this.objNavigationContainer=$(this.eventbox_container.identify()+"Navigation");this.objNavigation=this.objNavigationContainer.select("li");this.objDescriptionsContainer=$(this.eventbox_container.identify()+"Descriptions");this.objDescriptions=this.objDescriptionsContainer.select("div");if($(this.eventbox_container.identify()+"Container")){this.objContainer=$(this.eventbox_container.identify()+"Container")}if($(this.eventbox_container.identify()+"Overlay")){this.objOverlay=$(this.eventbox_container.identify()+"Overlay")}if($(this.eventbox_container.identify()+"Anchor")){this.objAnchor=$(this.eventbox_container.identify()+"Anchor")}this.windowDimensions=$(this.eventbox_container.identify()+"Window").getDimensions()}else{this.base_class=$w(this.eventbox_container.className).first();this.objWindowContainer=this.eventbox_container.down("."+this.base_class+"Window");this.objWindow=this.objWindowContainer.select("div");this.objNavigationContainer=this.eventbox_container.down("."+this.base_class+"Navigation");this.objNavigation=this.objNavigationContainer.select("li");this.objDescriptionsContainer=this.eventbox_container.down("."+this.base_class+"Descriptions");this.objDescriptions=this.objDescriptionsContainer.select("div");if(this.eventbox_container.down("."+this.base_class+"Container")){this.objContainer=this.eventbox_container.down("."+this.base_class+"Container")}if(this.eventbox_container.down("."+this.base_class+"Overlay")){this.objOverlay=this.eventbox_container.down("."+this.base_class+"Overlay")}if(this.eventbox_container.down("."+this.base_class+"Anchor")){this.objAnchor=this.eventbox_container.down("."+this.base_class+"Anchor")}if(this.eventbox_container.down("."+this.base_class+"Play")){this.objPlay=this.eventbox_container.down("."+this.base_class+"Play")}if(this.eventbox_container.down("."+this.base_class+"Stop")){this.objStop=this.eventbox_container.down("."+this.base_class+"Stop")}if(this.eventbox_container.down("."+this.base_class+"Pause")){this.objPause=this.eventbox_container.down("."+this.base_class+"Pause")}if(this.eventbox_container.down("."+this.base_class+"ControlNext")){this.objNext=this.eventbox_container.down("."+this.base_class+"ControlNext")}if(this.eventbox_container.down("."+this.base_class+"ControlPrevious")){this.objPrev=this.eventbox_container.down("."+this.base_class+"ControlPrevious")}this.windowDimensions=this.eventbox_container.down("."+this.base_class+"Window").getDimensions()}this.previous_content=0;this.active_content=-1;this.active_content=this.getNextImage(!isNaN(this.settings.firstSlide)?parseInt(this.settings.firstSlide)-1:this.objWindow.size());if(this.settings.slider.active){this._sliderInit()}this.objWindow.invoke("hide").invoke("absolutize").invoke("setStyle",{top:0,left:0,width:this.windowDimensions.width+"px",height:this.windowDimensions.height+"px"});this.objDescriptions.invoke("hide");if(this.settings.transitionDescriptions){var f=this.objDescriptions.first().up("div");var b=f.getWidth()-parseInt(this.objDescriptions.first().getStyle("padding-left"))-parseInt(this.objDescriptions.first().getStyle("padding-right"))+"px";var g=f.getHeight()-parseInt(this.objDescriptions.first().getStyle("padding-top"))-parseInt(this.objDescriptions.first().getStyle("padding-bottom"))+"px";this.objDescriptions.invoke("setStyle",{position:"absolute",width:b,height:g})}this.objNavigation.each(function(i,h){i.removeClassName("on");this.toggleNavigation(h,"on")}.bind(this));this.objWindow[this.active_content].show();this.objNavigation[this.active_content].addClassName("on");if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[this.active_content].show()}if(this.objAnchor){this.updateAnchor(this.active_content)}if(this.settings.setAsBackground){this.objWindow[this.active_content].setStyle({backgroundImage:"url("+this.objWindow[this.active_content].down("img").hide().readAttribute("src")+")"});if(this.objAnchor){this.objAnchor.setStyle({width:this.windowDimensions.width+"px",height:this.windowDimensions.height+"px"})}Event.observe(window,"resize",function(h){this.windowDimensions=this.eventbox_container.down("."+this.base_class+"Window").getDimensions();this.objWindow.invoke("setStyle",{width:this.windowDimensions.width+"px",height:this.windowDimensions.height+"px"});if(this.objAnchor){this.objAnchor.setStyle({width:this.windowDimensions.width+"px",height:this.windowDimensions.height+"px"})}}.bind(this))}this.toggleNavigation(this.active_content,"off");if(this.settings.type!=""&&this.settings.type!="static"&&!this.isPaused&&!this.isTransitioning){this.interval=setTimeout(this.doTransition.bind(this,-1),this.settings.delay)}if(this.settings.pauseOnMouseOver&&this.interval){this.addObservers()}if(this.settings.startPaused){if(this.objPause){this.objPause.fire("rotator:pause")}else{this.pause()}}if(this.objPlay){this.objPlay.observe("click",function(h){h.stop();this.resume()}.bind(this))}if(this.objStop){this.objStop.observe("click",function(h){h.stop();this.pause()}.bind(this))}if(this.objPause){this.objPause.observe("click",function(h){h.stop();this.objPause.fire("rotator:pause")}.bind(this))}if(this.objNext){this.objNext.observe("click",function(h){h.stop();this.doTransition(-1);if(this.objPause&&!this.isPaused){this.objPause.fire("rotator:pause")}}.bind(this))}if(this.objPrev){this.objPrev.observe("click",function(h){h.stop();this.doTransition((this.active_content-1<0)?this.objWindow.size()-1:this.active_content-1);if(this.objPause&&!this.isPaused){this.objPause.fire("rotator:pause")}}.bind(this))}this.onLoaded()},addObservers:function(){var a=this.objContainer||this.eventbox_container;this.boundPause=this._pause.bind(this);this.boundResume=this._resume.bind(this);a.observe("mouseover",this.boundPause);a.observe("mouseout",this.boundResume);if(this.objPause){this.objPause.stopObserving("rotator:pause").observe("rotator:pause",function(b){if(this.isPaused){this.resume();this.objPause.removeClassName("stopped").addClassName("playing");this.objPause.down("span").update("Pause")}else{this.pause();this.objPause.removeClassName("playing").addClassName("stopped");this.objPause.down("span").update("Resume")}}.bind(this))}},cancelObservers:function(){var a=this.objContainer||this.eventbox_container;a.stopObserving("mouseover",this.boundPause);a.stopObserving("mouseout",this.boundResume)},afterTransition:function(){this.isTransitioning=false;this.toggleNavigation("all","on");if(this.objWindow[this.previous_content]&&this.objWindow[this.previous_content]!=this.objWindow[this.active_content]){this.objWindow[this.previous_content].hide();this.objDescriptions[this.previous_content].hide()}if(this.settings.type!=""&&this.settings.type!="static"&&!this.isPaused){this.interval=setTimeout(this.doTransition.bind(this,-1),this.settings.delay)}this.onTransition()},doTransition:function(a){this.onBeforeTransition();clearTimeout(this.interval);this.isTransitioning=true;this.toggleNavigation("all","off");a=this.getNextImage(a);if(this.previous_content!=this.active_content&&this.previous_content!=a){this.objWindow[this.previous_content].hide();this.objWindow[this.previous_content].setStyle({left:0});this.objDescriptions[this.previous_content].hide()}this.objWindow[a].show();if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[a].show()}if(!this.settings.transitionDescriptions){this.objDescriptions[this.active_content].hide()}if(this.objOverlay&&!this.objOverlay.visible()){this.objOverlay.show()}if(this.objAnchor){if(!this.objAnchor.visible()){this.objAnchor.show()}this.updateAnchor(a)}if(this.settings.setAsBackground){this.objWindow[a].setStyle({backgroundImage:"url("+this.objWindow[a].down("img").hide().readAttribute("src")+")"})}switch(this.settings.type){case"slide_horizontal":this.doTransition_slideHorizontal(a);break;case"slide_vertical":this.doTransition_slideVertical(a);break;case"fade":this.doTransition_fade(a);break;case"fade_delay":this.doTransition_fadeDelay(a);break;default:this.objWindow[this.active_content].hide();this.objDescriptions[this.active_content].hide();this.afterTransition();break}this.objNavigation[this.active_content].removeClassName("on");this.objNavigation[a].addClassName("on");this.previous_content=this.active_content;this.active_content=a;if(this.settings.slider.active&&!this.navigationIsPaused){this._sliderMove()}},doTransition_slideHorizontal:function(a){if(a>this.active_content){this.objWindow[a].setStyle({left:(this.windowDimensions.width-2)+"px"});new Effect.Move(this.objWindow[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute",afterFinish:this.afterTransition.bind(this)});new Effect.Move(this.objWindow[this.active_content],{x:-this.windowDimensions.width,y:0,duration:this.settings.duration,mode:"absolute"});if(this.settings.transitionDescriptions){if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){new Effect.Move(this.objDescriptions[this.active_content],{x:-this.windowDimensions.width,y:0,duration:this.settings.duration,mode:"absolute"})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[a].setStyle({left:(this.windowDimensions.width-2)+"px"});new Effect.Move(this.objDescriptions[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute"})}}}else{this.objWindow[a].setStyle({left:(-this.windowDimensions.width)+"px"});new Effect.Move(this.objWindow[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute",afterFinish:this.afterTransition.bind(this)});new Effect.Move(this.objWindow[this.active_content],{x:this.windowDimensions.width,y:0,duration:this.settings.duration,mode:"absolute"});if(this.settings.transitionDescriptions){if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){new Effect.Move(this.objDescriptions[this.active_content],{x:this.windowDimensions.width,y:0,duration:this.settings.duration,mode:"absolute"})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[a].setStyle({left:(-this.windowDimensions.width)+"px"});new Effect.Move(this.objDescriptions[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute"})}}}},doTransition_slideVertical:function(a){if(a>this.active_content){this.objWindow[a].setStyle({top:(this.windowDimensions.height)+"px"});new Effect.Move(this.objWindow[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute",afterFinish:this.afterTransition.bind(this)});new Effect.Move(this.objWindow[this.active_content],{x:0,y:-this.windowDimensions.height,duration:this.settings.duration,mode:"absolute"});if(this.settings.transitionDescriptions){if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){new Effect.Move(this.objDescriptions[this.active_content],{x:0,y:-this.windowDimensions.height,duration:this.settings.duration,mode:"absolute"})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[a].setStyle({top:(this.windowDimensions.height)+"px"});new Effect.Move(this.objDescriptions[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute"})}}}else{this.objWindow[a].setStyle({top:-(this.windowDimensions.height)+"px"});new Effect.Move(this.objWindow[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute",afterFinish:this.afterTransition.bind(this)});new Effect.Move(this.objWindow[this.active_content],{x:0,y:this.windowDimensions.height,duration:this.settings.duration,mode:"absolute"});if(this.settings.transitionDescriptions){if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){new Effect.Move(this.objDescriptions[this.active_content],{x:0,y:this.windowDimensions.height,duration:this.settings.duration,mode:"absolute"})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){this.objDescriptions[a].setStyle({top:-(this.windowDimensions.height)+"px"});new Effect.Move(this.objDescriptions[a],{x:0,y:0,duration:this.settings.duration,mode:"absolute"})}}}},doTransition_fade:function(a){this.objWindow[a].style.zIndex=1;this.objWindow[this.active_content].style.zIndex=0;this.objWindow[a].hide();Effect.Appear(this.objWindow[a],{duration:this.settings.duration,afterFinish:this.afterTransition.bind(this)});if(this.settings.transitionDescriptions){if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){var b=this.objDescriptions[this.active_content].getStyle("opacity");this.objDescriptions[this.active_content].style.zIndex=0;this.objDescriptions[this.active_content].fade({duration:this.settings.duration,from:b})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){var b=this.objDescriptions[a].getStyle("opacity");this.objDescriptions[a].style.zIndex=1;this.objDescriptions[a].hide();Effect.Appear(this.objDescriptions[a],{duration:this.settings.duration,to:b})}}},doTransition_fadeDelay:function(a){this.objWindow[a].style.zIndex=1;this.objWindow[this.active_content].style.zIndex=0;this.objWindow[a].hide();this.objWindow[this.active_content].fade({duration:this.settings.duration,afterFinish:function(){if(!this.isPaused){this.cancelObservers()}new PeriodicalExecuter(function(c){Effect.Appear(this.objWindow[a],{duration:this.settings.duration,afterFinish:function(){this.afterTransition();if(!this.isPaused){this.addObservers()}}.bind(this)});c.stop()}.bind(this),this.settings.effectDelay)}.bind(this)});if(this.settings.transitionDescriptions){var b=0.8;if(!this.objDescriptions[this.active_content].empty()||this.settings.showEmptyDescriptions){b=this.objDescriptions[this.active_content].getStyle("opacity");this.objDescriptions[this.active_content].fade({duration:this.settings.duration,from:b,to:0,afterFinish:function(){this.objDescriptions[this.active_content].hide().setStyle({opacity:b})}.bind(this)})}if(!this.objDescriptions[a].empty()||this.settings.showEmptyDescriptions){b=this.objDescriptions[a].getStyle("opacity");this.objDescriptions[a].hide();new PeriodicalExecuter(function(c){Effect.Appear(this.objDescriptions[a],{duration:this.settings.duration,from:0,to:b});c.stop()}.bind(this),this.settings.effectDelay+this.settings.duration)}}},getNextImage:function(a){switch(this.settings.order){case"sequential":if(a<0){a=this.active_content+1}if((a+1)>this.objWindow.size()){a=0}break;case"random":a=this.getRandom();break}return a},getRandom:function(){var a=Math.floor(Math.random()*this.objWindow.size());if(a==this.active_content){return this.getRandom()}else{return a}},_pause:function(){clearTimeout(this.interval);this.isPaused=true},_resume:function(){clearTimeout(this.interval);if(!this.isTransitioning){this.interval=setTimeout(this.doTransition.bind(this,-1),this.settings.delay)}this.isPaused=false},pause:function(){this.onBeforePause();this._pause();this.cancelObservers();this.onPause()},resume:function(){this.onBeforeResume();this._resume();if(typeof $f=="function"){$f("*").each(function(){this.unload()})}this.addObservers();this.onResume()},flowplayer_init:function(a){a.onBegin(function(){this.pause();this.objDescriptionsContainer.fade({duration:0.5})}.bind(this));a.onFinish(function(){this.resume()}.bind(this));a.onUnload(function(){this.objDescriptionsContainer.appear({duration:0.5})}.bind(this))},_flowplayer_play:function(){var a=$(this.flowplayerID).cloneNode(true).writeAttribute("id","");a.identify();var b=flowplayer(this.flowplayerID);this.pause();this.viewerCreate();this.viewer_container.setStyle({width:$(this.flowplayerID).getStyle("width"),height:$(this.flowplayerID).getStyle("height")});this.viewerShow();this.viewer_content.insert(a.update());var c=b.getConfig(true);c.key=this.settings.flowplayer_settings.key;c.logo=this.settings.flowplayer_settings.logo;flowplayer(a.identify(),{src:this.settings.flowplayer_settings.swf,wmode:"opaque"},c).ipad();flowplayer(a.identify()).onFinish(function(){this.videoIsPlaying=false;this.resume();this.viewerDestroy()}.bind(this));this.videoIsPlaying=true},_flowplayer_stop:function(){if(this.objAnchor){this.objAnchor.stopObserving("click");this.objAnchor.observe("click",function(a){a.stop();this._flowplayer_play()}.bind(this))}this.eventbox_container.select("a[rel*='flowplayer[']").each(function(c){var d=c.readAttribute("rel");var b=d.match(/flowplayer\[(.*)\]/i);if(Object.isArray(b)&&b.size()>1){var a=b.last();if(flowplayer(a).isLoaded()){flowplayer(a).stop();flowplayer(a).unload();this.videoIsPlaying=false;this.resume()}}}.bind(this))},toggleNavigation:function(a,b){if(b==undefined){b="on"}if(a==undefined){a="all"}if(this.isPaused&&!!this.flowplayerID){this._flowplayer_stop()}if(a=="all"){this.objWindow.each(function(c,d){if(d!=this.active_content){this.toggleNavigation(d,b)}}.bind(this))}else{if(b=="off"){this.objNavigation[a].setStyle({cursor:"default"}).stopObserving("click")}else{this.objNavigation[a].setStyle({cursor:"pointer"}).stopObserving("click").observe("click",function(c){this.doTransition(a)}.bind(this))}}},updateAnchor:function(d){this.objAnchor.stopObserving("click");this.flowplayerID=false;if(this.objWindow[d].down("a")){var b=this.objWindow[d].down("a").readAttribute("rel");var c=this.objWindow[d].down("a").readAttribute("target")||"_self";var a="";if(b){a=b.match(/flowplayer\[(.*)\]/i)}if(b!="no_follow"){this.objAnchor.show().writeAttribute("href",this.objWindow[d].down("a").readAttribute("href")).writeAttribute("target",c)}else{this.objAnchor.hide().writeAttribute("href","")}if(Object.isArray(a)&&a.size()>1){this.flowplayerID=a[1];if(this.settings.video.hideOverlay){this.objAnchor.hide();if(this.objOverlay){this.objOverlay.hide()}}else{this.objAnchor.observe("click",function(e){e.stop();this._flowplayer_play()}.bind(this))}}}else{this.objAnchor.hide().writeAttribute("href","")}},_sliderInit:function(){this.slider_container=this.objNavigationContainer.up("."+this.settings.slider.container);this.slider_button_next=this.eventbox_container.down("."+this.settings.slider.button_next);this.slider_button_previous=this.eventbox_container.down("."+this.settings.slider.button_previous);this.slider_navigation_timeout="";this.slider_handle=new Element("span",{style:"display: none;"});this.slider_container.insert(this.slider_handle);var e=["margin-top","margin-bottom"];var c=["margin-left","margin-right"];var a=(this.settings.slider.orientation=="vertical")?e:c;var d=(this.settings.slider.orientation=="vertical")?this.slider_container.getHeight():this.slider_container.getWidth();var b=0;this.objNavigation.each(function(f){b+=(this.settings.slider.orientation=="vertical")?f.getHeight():f.getWidth();a.each(function(g){prop_value=parseInt(f.getStyle(g));if(!isNaN(prop_value)){b+=prop_value}})}.bind(this));if(this.settings.slider.orientation=="vertical"){this.objNavigationContainer.setStyle({height:b+"px"})}else{this.objNavigationContainer.setStyle({width:b+"px"})}this.settings.slider.item_dimension=b/this.objNavigation.size();this.settings.slider.max_range=b-d+1;this.settings.slider.current_value=0;this.slider_values=$R(0,this.settings.slider.max_range).partition(function(f){return 0==f%(this.settings.slider.item_dimension*this.settings.slider.step)}.bind(this)).first();(this.slider_values.last()!=this.settings.slider.max_range)?this.slider_values.push(this.settings.slider.max_range):Prototype.emptyFunction;this.slider_control=new Control.Slider(this.slider_handle,this.slider_container,{axis:this.settings.slider.orientation,range:$R(0,this.settings.slider.max_range),increment:this.settings.slider.item_dimension,values:this.slider_values,onChange:function(g){var f=(this.settings.slider.orientation=="vertical")?"top":"left";new Effect.Morph(this.objNavigationContainer,{style:f+": "+g*-1+"px",duration:this.settings.duration})}.bind(this)});if(this.slider_button_next){if(this.objNavigation.size()>this.settings.slider.view){this.slider_button_next.observe("click",function(f){f.stop();this.settings.slider.current_value+=this.settings.slider.item_dimension*this.settings.slider.step;if(this.settings.slider.current_value>this.settings.slider.max_range){this.settings.slider.current_value=this.settings.slider.max_range}this.slider_control.setValue(this.settings.slider.current_value)}.bind(this))}}if(this.slider_button_previous){if(this.objNavigation.size()>this.settings.slider.view){this.slider_button_previous.observe("click",function(f){f.stop();this.settings.slider.current_value-=this.settings.slider.item_dimension*this.settings.slider.step;if(this.settings.slider.current_value<0){this.settings.slider.current_value=0}else{if(this.slider_values.indexOf(this.settings.slider.current_value)<0){this.settings.slider.current_value=this.slider_values.detect(function(g){return g>this.settings.slider.current_value}.bind(this))}}this.slider_control.setValue(this.settings.slider.current_value)}.bind(this))}}this._sliderMove()},_sliderMove:function(){var a=this.active_content*this.settings.slider.item_dimension;var b=this.settings.slider.item_dimension*this.settings.slider.view;if(a-this.settings.slider.current_value>=b){this.settings.slider.current_value+=this.settings.slider.item_dimension*this.settings.slider.step;if(this.settings.slider.current_value>this.settings.slider.max_range){this.settings.slider.current_value=this.settings.slider.max_range}if(a-this.settings.slider.current_value>=b){this._sliderMove()}else{this.slider_control.setValue(this.settings.slider.current_value)}}else{if(a<this.settings.slider.current_value){this.settings.slider.current_value-=this.settings.slider.item_dimension*this.settings.slider.step;if(this.settings.slider.current_value<0){this.settings.slider.current_value=0}if(a<this.settings.slider.current_value){this._sliderMove()}else{if(this.slider_values.indexOf(this.settings.slider.current_value)<0){this.settings.slider.current_value=this.slider_values.reverse(false).detect(function(c){return c<=a}.bind(this))}this.slider_control.setValue(this.settings.slider.current_value)}}}},_detectMacXFF:function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("mac")!=-1&&a.indexOf("firefox")!=-1){return true}},viewerCreate:function(){this.viewer_parent=$(document.getElementsByTagName("body").item(0));this.viewer_backdrop=new Element("div",{style:"display: none;"});this.viewer_container=new Element("div",{style:"display: none;"});this.viewer_window=new Element("div");this.viewer_content=new Element("div");this.viewer_close=new Element("a",{href:"#"}).insert(new Element("img",{src:"/includes/eventbox/images/viewer_close.png"}));if(!this.settings.video.popupSettings.className.blank()){this.viewer_container.addClassName(this.settings.video.popupSettings.className)}var a=this._detectMacXFF();if(a){this.viewer_backdrop.setStyle({backgroundImage:"url(/includes/login/trans.png)",backgroundRepeat:"repeat",backgroundColor:""})}else{this.viewer_backdrop.setStyle({opacity:0.7,backgroundColor:"#000"})}this.viewer_backdrop.setStyle({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9000});this.viewer_container.setStyle({position:"absolute",top:parseInt(this.settings.video.popupSettings.top)+"px",left:"100px",width:"500px",height:"500px",padding:parseInt(this.settings.video.popupSettings.padding)+"px",backgroundColor:this.settings.video.popupSettings.backgroundColor,zIndex:9010});this.viewer_close.setStyle({position:"absolute",top:"-15px",right:"-15px",opacity:0.8,zIndex:9015});this.viewer_parent.insert({top:this.viewer_backdrop});this.viewer_backdrop.insert({after:this.viewer_container});this.viewer_container.insert(this.viewer_window);this.viewer_window.insert(this.viewer_close);this.viewer_window.insert(this.viewer_content);[this.viewer_backdrop,this.viewer_close].each(function(b){b.observe("click",function(c){c.stop();this.videoIsPlaying=false;this.resume();this.viewerDestroy()}.bind(this))}.bind(this))},viewerDestroy:function(){this.viewer_backdrop.fade({duration:0.5,afterFinish:function(){this.viewer_backdrop.remove()}.bind(this)});this.viewer_container.fade({duration:0.5,afterFinish:function(){this.viewer_container.remove()}.bind(this)})},_viewerMove:function(){var a=document.viewport.getScrollOffsets();this.viewer_container.setStyle({top:a.top+parseInt(this.settings.video.popupSettings.top)+"px",left:((this.viewer_backdrop.getWidth()-this.viewer_container.getWidth())/2)+"px"})},viewerShow:function(){[this.viewer_backdrop,this.viewer_container].invoke("show");this._viewerMove()}});